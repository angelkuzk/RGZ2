{% extends "base.html" %}

{% block title %}–°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤{% endblock %}

{% block content %}
<div class="employees-header">
    <h2 style="color: #2c3e50; margin-bottom: 1.5rem;">–°–ø–∏—Å–æ–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h2>
    
    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–∞–≤–∞—Ö –¥–æ—Å—Ç—É–ø–∞ -->
    {% if not is_authenticated %}
    <div class="access-info access-guest">
        <p style="margin: 0; color: #2c3e50;">
            <strong>üîí –ì–æ—Å—Ç–µ–≤–æ–π –¥–æ—Å—Ç—É–ø</strong> - –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –§–ò–û –∏ –¥–æ–ª–∂–Ω–æ—Å—Ç–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤. 
            <a href="{{ url_for('login') }}" style="color: #3498db; font-weight: 600;">–í–æ–π–¥–∏—Ç–µ –≤ —Å–∏—Å—Ç–µ–º—É</a> –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.
        </p>
    </div>
    {% elif not is_hr %}
    <div class="access-info access-user">
        <p style="margin: 0; color: #2c3e50;">
            <strong>üë§ –ü—Ä–∞–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</strong> - –¥–æ—Å—Ç—É–ø–µ–Ω –ø—Ä–æ—Å–º–æ—Ç—Ä –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤. 
            –î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏ —Ç—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ –∫–∞–¥—Ä–æ–≤–∏–∫–∞.
        </p>
    </div>
    {% endif %}
    
    <!-- –§–∏–ª—å—Ç—Ä—ã –∏ –ø–æ–∏—Å–∫ -->
    <div class="filters-container">
        <!-- –ü–æ–∏—Å–∫ -->
        <form method="GET" class="search-form">
            <input type="text" name="search" value="{{ search }}" placeholder="–ü–æ–∏—Å–∫ –ø–æ –§–ò–û, –¥–æ–ª–∂–Ω–æ—Å—Ç–∏, —Ç–µ–ª–µ—Ñ–æ–Ω—É –∏–ª–∏ email...">
            <button type="submit" class="btn">–ù–∞–π—Ç–∏</button>
            {% if search %}
                <a href="{{ url_for('employees') }}" class="btn btn-cancel">–°–±—Ä–æ—Å–∏—Ç—å –ø–æ–∏—Å–∫</a>
            {% endif %}
        </form>

        <!-- –§–∏–ª—å—Ç—Ä —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ -->
        <form method="GET" class="sort-filter-form">
            <input type="hidden" name="search" value="{{ search }}">
            
            <div class="filter-group">
                <label for="sort_field">–°–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ:</label>
                <select name="sort" id="sort_field" onchange="this.form.submit()">
                    <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª–µ --</option>
                    <option value="full_name" {% if sort_field == 'full_name' %}selected{% endif %}>–§–ò–û</option>
                    <option value="position" {% if sort_field == 'position' %}selected{% endif %}>–î–æ–ª–∂–Ω–æ—Å—Ç—å</option>
                    {% if is_authenticated %}
                    <option value="gender" {% if sort_field == 'gender' %}selected{% endif %}>–ü–æ–ª</option>
                    <option value="phone" {% if sort_field == 'phone' %}selected{% endif %}>–¢–µ–ª–µ—Ñ–æ–Ω</option>
                    <option value="email" {% if sort_field == 'email' %}selected{% endif %}>Email</option>
                    <option value="hire_date" {% if sort_field == 'hire_date' %}selected{% endif %}>–î–∞—Ç–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</option>
                    <option value="on_probation" {% if sort_field == 'on_probation' %}selected{% endif %}>–ò—Å–ø—ã—Ç–∞—Ç–µ–ª—å–Ω—ã–π —Å—Ä–æ–∫</option>
                    {% endif %}
                </select>
            </div>

            <div class="filter-group">
                <label for="sort_order">–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:</label>
                <select name="order" id="sort_order" onchange="this.form.submit()">
                    <option value="asc" {% if sort_order == 'asc' %}selected{% endif %}>–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é (–ê-–Ø)</option>
                    <option value="desc" {% if sort_order == 'desc' %}selected{% endif %}>–ü–æ —É–±—ã–≤–∞–Ω–∏—é (–Ø-–ê)</option>
                </select>
            </div>

            {% if sort_field %}
                <a href="{{ url_for('employees', search=search) }}" class="btn btn-cancel">–°–±—Ä–æ—Å–∏—Ç—å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É</a>
            {% endif %}
        </form>
    </div>
</div>

{% if is_hr %}
<div style="margin-bottom: 1.5rem;">
    <a href="{{ url_for('add_employee') }}" class="btn">‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–≥–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</a>
</div>
{% endif %}

<!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç–µ–∫—É—â–µ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–µ -->
{% if sort_field %}
<div class="sort-info">
    üìä –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: 
    <strong>
        {% if sort_field == 'full_name' %}–§–ò–û
        {% elif sort_field == 'position' %}–î–æ–ª–∂–Ω–æ—Å—Ç—å
        {% elif sort_field == 'gender' %}–ü–æ–ª
        {% elif sort_field == 'phone' %}–¢–µ–ª–µ—Ñ–æ–Ω
        {% elif sort_field == 'email' %}Email
        {% elif sort_field == 'hire_date' %}–î–∞—Ç–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞
        {% elif sort_field == 'on_probation' %}–ò—Å–ø—ã—Ç–∞—Ç–µ–ª—å–Ω—ã–π —Å—Ä–æ–∫
        {% endif %}
    </strong>
    ‚Ä¢ 
    <strong>
        {% if sort_order == 'asc' %}–ü–æ –≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏—é
        {% else %}–ü–æ —É–±—ã–≤–∞–Ω–∏—é
        {% endif %}
    </strong>
</div>
{% endif %}

<!-- –¢–∞–±–ª–∏—Ü–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ -->
<div style="overflow-x: auto;">
    <table class="employees-table">
        <thead>
            <tr>
                <th>
                    <a href="?{% if search %}search={{ search }}&{% endif %}sort=full_name&order={{ 'desc' if sort_field == 'full_name' and sort_order == 'asc' else 'asc' }}">
                        –§–ò–û {% if sort_field == 'full_name' %}{{ '‚Üë' if sort_order == 'asc' else '‚Üì' }}{% endif %}
                    </a>
                </th>
                <th>
                    <a href="?{% if search %}search={{ search }}&{% endif %}sort=position&order={{ 'desc' if sort_field == 'position' and sort_order == 'asc' else 'asc' }}">
                        –î–æ–ª–∂–Ω–æ—Å—Ç—å {% if sort_field == 'position' %}{{ '‚Üë' if sort_order == 'asc' else '‚Üì' }}{% endif %}
                    </a>
                </th>
                {% if is_authenticated %}
                <th>
                    <a href="?{% if search %}search={{ search }}&{% endif %}sort=gender&order={{ 'desc' if sort_field == 'gender' and sort_order == 'asc' else 'asc' }}">
                        –ü–æ–ª {% if sort_field == 'gender' %}{{ '‚Üë' if sort_order == 'asc' else '‚Üì' }}{% endif %}
                    </a>
                </th>
                <th>
                    <a href="?{% if search %}search={{ search }}&{% endif %}sort=phone&order={{ 'desc' if sort_field == 'phone' and sort_order == 'asc' else 'asc' }}">
                        –¢–µ–ª–µ—Ñ–æ–Ω {% if sort_field == 'phone' %}{{ '‚Üë' if sort_order == 'asc' else '‚Üì' }}{% endif %}
                    </a>
                </th>
                <th>
                    <a href="?{% if search %}search={{ search }}&{% endif %}sort=email&order={{ 'desc' if sort_field == 'email' and sort_order == 'asc' else 'asc' }}">
                        Email {% if sort_field == 'email' %}{{ '‚Üë' if sort_order == 'asc' else '‚Üì' }}{% endif %}
                    </a>
                </th>
                <th>
                    <a href="?{% if search %}search={{ search }}&{% endif %}sort=on_probation&order={{ 'desc' if sort_field == 'on_probation' and sort_order == 'asc' else 'asc' }}">
                        –ò—Å–ø. —Å—Ä–æ–∫ {% if sort_field == 'on_probation' %}{{ '‚Üë' if sort_order == 'asc' else '‚Üì' }}{% endif %}
                    </a>
                </th>
                <th>
                    <a href="?{% if search %}search={{ search }}&{% endif %}sort=hire_date&order={{ 'desc' if sort_field == 'hire_date' and sort_order == 'asc' else 'asc' }}">
                        –î–∞—Ç–∞ —É—Å—Ç. {% if sort_field == 'hire_date' %}{{ '‚Üë' if sort_order == 'asc' else '‚Üì' }}{% endif %}
                    </a>
                </th>
                {% if is_hr %}
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                {% endif %}
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for employee in employees.items %}
            <tr>
                <td><strong>{{ employee.full_name }}</strong></td>
                <td>{{ employee.position }}</td>
                {% if is_authenticated %}
                <td style="text-align: center;">{{ '–ú' if employee.gender == 'male' else '–ñ' }}</td>
                <td style="white-space: nowrap; font-size: 0.9rem;">{{ employee.phone }}</td>
                <td style="font-size: 0.9rem;">{{ employee.email }}</td>
                <td style="text-align: center;">
                    <span class="probation-badge {{ 'probation-yes' if employee.on_probation else 'probation-no' }}">
                        {{ '–î–∞' if employee.on_probation else '–ù–µ—Ç' }}
                    </span>
                </td>
                <td style="font-size: 0.9rem;">{{ employee.hire_date.strftime('%d.%m.%Y') }}</td>
                {% if is_hr %}
                <td class="actions">
                    <a href="{{ url_for('edit_employee', employee_id=employee.id) }}" class="btn btn-edit" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</a>
                    <a href="{{ url_for('delete_employee', employee_id=employee.id) }}" 
                       class="btn btn-delete" 
                       onclick="return confirm('–£–¥–∞–ª–∏—Ç—å {{ employee.full_name }}?')"
                       title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</a>
                </td>
                {% endif %}
                {% endif %}
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
<div class="pagination">
    {% if employees.has_prev %}
        <a href="?page={{ employees.prev_num }}&{% if search %}search={{ search }}&{% endif %}{% if sort_field %}sort={{ sort_field }}&order={{ sort_order }}&{% endif %}" class="btn">‚¨ÖÔ∏è –ù–∞–∑–∞–¥</a>
    {% endif %}
    
    <span style="color: #6c757d; font-weight: 500;">–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ employees.page }} –∏–∑ {{ employees.pages }}</span>
    
    {% if employees.has_next %}
        <a href="?page={{ employees.next_num }}&{% if search %}search={{ search }}&{% endif %}{% if sort_field %}sort={{ sort_field }}&order={{ sort_order }}&{% endif %}" class="btn">–ü–æ–∫–∞–∑–∞—Ç—å –µ—â—ë ‚û°Ô∏è</a>
    {% endif %}
</div>

<div class="employees-count">
    –ü–æ–∫–∞–∑–∞–Ω–æ: {{ employees.items|length }} –∏–∑ {{ employees.total }} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤
</div>
{% endblock %}